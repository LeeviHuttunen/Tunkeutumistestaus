# Lisää vain vesi

## x) Lue/katso/kuuntele ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva.) € Jaswal 2020: Mastering Metasploit - 4ed: Chapter 1: Approaching a Penetration Test Using Metasploit (kohdasta Conducting a penetration test with Metasploit luvun loppuun eli "Summary" loppuun)

- Tässä kirjan kappaleessa käsiteltiin Metalsploitin komentoja ja toimintoja, joista tulee olemaan hyötyä näissä kotitehtävissä.
- Metalsploitilla voidaan paljastaa haavoittuvuuksia käyttäen yhtä ohjelmaa 200 eri ohjelman sijasta. Sillä säästää siis aikaa ja vaivaa.
- Metasploit käyttää database-malleja, joihin voidaan tallentaa eri tietoja hyökkäyskohteista, jotka ovat hyödyllisiä.
- Kirjassa käytiin läpi, kuinka hyökättiin annettuun ip-osoitteeseen nmappia käyttäen.

## a) Harjoittelemme omassa virtuaaliverkossa, jossa on Kali ja Metaspoitable. Osoita testein, että 1) koneet eivät saa yhteyttä Internetiin 2) Koneet saavat yhteyden toisiinsa. (Koneiden ja verkon asentamista ei tarvitse raportoida uudestaan, paitsi jos siinä on ongelmia)

<img width="580" height="308" alt="image" src="https://github.com/user-attachments/assets/d50e970a-03ed-497d-bec7-dcf2363ee23a" />

<img width="425" height="68" alt="image" src="https://github.com/user-attachments/assets/dffb675a-2490-4883-862d-adf90c4ba5e6" />

Kumpikaan kone ei saa yhteyttä verkkoon, mutta Kali on yhteydessä Metalspoitable-koneeseen.

## b) Ota Metasploit msfconsole käyttöön

<img width="467" height="466" alt="image" src="https://github.com/user-attachments/assets/78dc99e8-d2de-4082-b9bc-c33a08b09155" />

`msfconsole` komennolla otin Metasploitin käyttöön  

## c) Etsi Metasploitable porttiskannaamalla (db_nmap -sn). Tarkista selaimella, että löysit oikean IP:n - Metasploitablen weppipalvelimen etusivulla lukee Metasploitable.

<img width="554" height="493" alt="image" src="https://github.com/user-attachments/assets/680515f0-b9d8-4fa8-ba5d-6221f6f5e072" />

- Oikea ip-osoite varmistettu

- Ensiksi loin uuden tietokannan Metasploitiin `sudo msfdb init` 

- Löysin Kohteen komennolla `db_nmap -sn 192.168.56.102`

<img width="626" height="184" alt="image" src="https://github.com/user-attachments/assets/f7590c55-6076-4922-b684-d5b3e4970954" />

## d) Porttiskannaa Metasploitable perusteellisesti. Skannaa kaikki 65535 tcp-porttia. Tallenna tulokset Metasploitin tietokantoihin (db_nmap) ja tiedostoihin (nmap -oA foo).

- Porttiskannasin Metasploitable koneen komennolla `db_nmap -A -p- 192.168.56.102` Skannaamisessa meni yli 5 minuuttia, joten otin `-A` pois, jotta skannaus nopeutuisi. Sitten tuli tuloksia alle minuutissa:

- <img width="631" height="455" alt="image" src="https://github.com/user-attachments/assets/ccecb9be-43b4-49d1-83a6-5ac44c5c79fb" />

## e) Tarkastele Metasploitin tietokantoihin tallennettuja tietoja komennoilla "hosts" ja "services". Kokeile suodattaa näitä listoja tai hakea niistä.

Services 

<img width="523" height="406" alt="image" src="https://github.com/user-attachments/assets/6f584a3c-6d8d-40e7-860b-16a85dca29d6" />

Hosts

<img width="609" height="202" alt="image" src="https://github.com/user-attachments/assets/93a70184-8b6d-4a31-94de-beaf8f396eef" />

Komennolla `services -p 22` Suodatin portin 22 tulokset.

<img width="396" height="156" alt="image" src="https://github.com/user-attachments/assets/72e7dfef-6596-421f-bb56-777b6bb5ed84" />

## f) Vertaile nmap:n omaa tiedostoon tallennusta (-oA foo) ja db_nmap:n tallennusta tietokantoihin. Mitkä ovat eri tiedostomuotojen ja Metasploitin tietokannan hyvät puolet?
- Tässä kohtaa pidin parin tunnin tauon ja jatkoin sitten. En saanut enää yhteyttä jostain syystä samaan databaseen, joten jouduin poistamaan vanhan databasen ja tekemään uuden tilalle komennolla `sudo msfdb reinit`. 

- D-kohdassa unohdin skannata tuolla `nmap -oA foo` ja `db_nmap -sV` komennoilla, joten nyt hosts ja services kohta näyttää enemmän tietoja, kuin aikaisemmin:

<img width="622" height="460" alt="image" src="https://github.com/user-attachments/assets/9439bb9a-8978-455f-8bde-f9101b356eff" />

Db_nmap tallentaa suoraan tietokantaan, kun taas -oA foo tallentaa tiedot helposti tulostettaviksi ja jaettaviksi.

## g) Murtaudu Metasploitablen vsftpd-palveluun
- Komennolla `search vsftpd` sain seuraavan tuloksen:

<img width="640" height="293" alt="image" src="https://github.com/user-attachments/assets/0e388157-063d-4445-8ae1-ee122fe9606a" />

- Siellä näkyy kohta 0 ja 1. Muistaakseni viime oppitunnilla puhuttiin, että komento `use 0` toimii tässä tilanteessa. Laitoin vielä hyökättävän koneen ip:n perään Teron ohjeiden mukaan. Sen jälkeen kirjoitin exploit:

<img width="625" height="123" alt="image" src="https://github.com/user-attachments/assets/7ca5b6ba-212c-4cfb-9403-2e47464f310f" />

Vastaus: Ei haavoittuvuuksia. Kokeilen sitten `use 1`

<img width="625" height="331" alt="image" src="https://github.com/user-attachments/assets/6fd135e2-d0ba-4dc2-b1b2-4ccafabc7095" />

Se toimi, piti vielä katsoa apua eri komennoista ja tällä kertaa komento `run` päästi meidät sisälle koneeseen.

## h) Päivitä äskeisen vsftpd-murron yhteydessä syntynyt sessio meterpretriin

Pienen pohdinnan (45min) jälkeen tajusin poistua hyökättävältä koneelta komennolla ctrl+z ja kirjoitin metasploitiin `sessions`

<img width="625" height="182" alt="image" src="https://github.com/user-attachments/assets/c1d7e692-1ff0-46c4-b8b1-7f74c8838139" />

Ja siellä on nyt meterpretr auki.

## i) Kerää levittäytymisessä (lateral movement) tarvittavaa tietoa metasploitablesta. Analysoi tiedot. Selitä, miten niitä voisi hyödyntää.

- Kokeilin kokeilumielessä kirjoittaa Python, joka oli iso virhe. Tämän jälkeen kone alkoi seota ja näppäimet ei toiminut. Jouduin käynnistämään koneen uudelleen tämän jälkeen, enkä päässyt enää kohdekoneen sisälle mitenkään, kuten seuraavissa kohdissa tulee ilmi:

<img width="631" height="382" alt="image" src="https://github.com/user-attachments/assets/d57c1f74-1b21-4151-8815-790f529ff370" />

Sitten en enää päässyt vsftpd:n kautta koneeseeen sisälle. Tuli aina sama ilmoitus:

<img width="629" height="109" alt="image" src="https://github.com/user-attachments/assets/81125e8a-c8b8-43a2-82a2-f46602700790" />

## j) Murtaudu Metasploitableen jollain toisella tavalla. (Jos tämä kohta on vaikea, voit tarvittaessa turvautua verkosta löytyviin läpikävelyohjeisiin. Merkitse silloin raporttiin, missä määrin tarvitsit niitä).

Ensiksi katsoin komennolla `services`, mitä kautta hyökkäisi koneelle. Löysin sieltä Telnetin ja Telnetin 17 näytti lupaavalta: 

<img width="629" height="55" alt="image" src="https://github.com/user-attachments/assets/5263f62f-4eac-4355-bb04-f7311fd25d23" />

Tämän jälkeen laitoin taas komennon `setg RHOSTS 192.168.56.102` ja sitten exploit.

<img width="633" height="89" alt="image" src="https://github.com/user-attachments/assets/f08b9d4f-6f39-4ee3-9fa7-67fca20615a1" />

Taas sama vastaus. Exploit completed but no session was created. 

<img width="492" height="59" alt="image" src="https://github.com/user-attachments/assets/3fcfbc69-675a-45d9-b614-9a6ae622ea8d" />


Internetissä oli sama ongelma ollut monella (https://forum.hackthebox.com/t/solved-exploit-completed-but-no-sessions-created/2488/57), mutta aika ei yksinkertaisesti riitä tällä erää ratkomaan tätä. Uskon kuitenkin, että exploit olisi onnistunut, jos bugia ei olisi ollut. Kokeilin murtautua 5 eri kautta, ftp, nfs jne. Mutta aina tuli sama ilmoitus. Tätä koitin ratkaista noin 3 tuntia, mutta en löytänyt ratkaisua. Tehtävät sain kuitenkin onneksi tehtyä hyvään vaiheeseen, kunnes en päässyt enää murtautumaan kohdekoneeseen.

## k) Demonstroi Meterpretrin ominaisuuksia.

- Komennolla `sysinfo` näkee koneen speksit
- Komennolla `ps` näkee hyökättävän kohteen käynnissä olevat prosessit.
- Komennolla `screenshare` näkee hyökättävän koneen näytön reaaliajassa. 




- Lähteet: https://labex.io/tutorials/nmap-how-to-resolve-metasploit-database-errors-418360 Täältä löytyi uuden databasen tekeminen, kuten kuvan tekstissäkin lukee.
- https://forum.hackthebox.com/t/solved-exploit-completed-but-no-sessions-created/2488/11 Sama ongelma ollut useilla, mikä itselle osui.
- https://techofide.com/blogs/how-to-use-metasploit-meterpreter-reverse-shell-metasploit-tutorial/ Täältä löytyi hyvin tietoa Meterpreteristä ja sen käytöstä.
- https://nmap.org/book/man-briefoptions.html Nmapin komentoja
- https://terokarvinen.com/tunkeutumistestaus/
