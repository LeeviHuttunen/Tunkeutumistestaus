# Täysin laillinen sertifikaatti

## x) Lue/katso ja tiivistä

## OWASP 2021: OWASP Top 10:2021
- Viallinen pääsynhallinta on riski, jota voidaan käyttää hyödyksi hakkeroinnissa.
- Esimerkiksi url:llän muokkaaminen, laiskasti tehty API-järjestelmä (esim. rajattomat API-pyynnöt) ovat hyviä hyökkäyskohteita
- Suojaamiskeinoja ovat deny by default, API-pyyntöjen rajoittaminen, käyttäjänvarmennus.

## Insecure direct object references (IDOR)
- Pääsynhallinnan haavoittuvuus
- Esimerkiksi jos käyttäjän numero on näkyvillä (esim. joku.com/customer_account?customer_number=132355) käyttäjänumeroa muuttaessa voi päästä toiselle käyttäjälle.

## Path traversal
- Path traversal haavoittuvuudessa voidaan mennä määriteltyä polkua pitkin tiedostoihin.
- Jos nettisivun url:ssä lukee, että kuva on ladattu suoraan tiedostoista, voidaan muihinkin kansioihin ja tiedostoihin päästä tavalla:(https://jokusivu.com/loadImage?filename=../../../etc/passwd)

## Cross-site scripting (XSS)
- Hyökkääjä voi laittaa haitallista Javascript-koodia hyökättävän selaimeen.
- Hyökkäyksellä voidaan kaapata käyttäjän tietoa ja saada käyttäjän sovelluksen hallinta itselleen.


## a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimine localhost:lla ilman Foxyproxya)

- Ensimmäisenä asensin Zapin komennolla `'sudo apt-get install zaproxy`
- Sitten pitäisi luoda sertifikaatti. Kohdasta tools-> options-> network-> server certificates löytyi sertifikaatti

  <img width="768" height="591" alt="image" src="https://github.com/user-attachments/assets/d347e8e1-40d0-4f29-a423-f004b5f9c766" />

- Tallensin sertifikaatin virtuaalikoneelleni. Seuraavaksi avasin Firefoxin, menin asetuksiin, josta kohdasta privacy and security laitoin hakusanaksi certificates. Kohdasta view certificates lisäsin luomani sertifikaatin sinne.

<img width="680" height="460" alt="image" src="https://github.com/user-attachments/assets/76d4ab99-8823-4e03-bad2-17724614c5a8" />

- Sitten asensin Zapin proxyksi Firefoxin asetuksista.

<img width="752" height="626" alt="image" src="https://github.com/user-attachments/assets/7f6a903b-b1f9-4222-a19d-b6cf521df0d9" />

Seuraavaksi avasin edellisissä tehtävissä käyttämäni Metalsploitable virtuaalikoneen. Ensiksi varmistin ettei Kali-Linux virtuaalikone ole verkossa ja että koneet ovat yhteydessä toisiinsa. Sitten pingasin Metalspoitablen ip-osoitteen.

<img width="1264" height="203" alt="image" src="https://github.com/user-attachments/assets/d9a9efdc-f009-4475-a93f-314e22799282" />

Firefoxissa ei näkynyt Metalspoitablen sivua, mutta Zappiin tuli hakupyyntöjä:

<img width="1151" height="255" alt="image" src="https://github.com/user-attachments/assets/ce9481de-295a-43ec-844c-52a51594608d" />

Sitten vielä laitoin Zapin sieppaamaan kuvat kohdasta: Options-> Display -> Klikkasin kohtaa Process images in HTTP requests/responses

<img width="743" height="566" alt="image" src="https://github.com/user-attachments/assets/9a643726-96e2-4346-8fd1-dabedfb05d4f" />

## b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)

- Ensiksi laitoin nat-verkon päälle, mutta proxy-yhteys ei antanut ottaa yhteyttä verkkoon. Jouduin laittamaan Proxyn hetkeksi pois päältä.

<img width="784" height="635" alt="image" src="https://github.com/user-attachments/assets/ab437ea2-8e8c-421a-bd5a-51c5f73ab1ab" />

Sitten menin Foxyproxyn asetuksiin Firefoxista -> add-ons and themes -> Extensions -> Foxyproxyn kohdalla Preferences

<img width="1245" height="519" alt="image" src="https://github.com/user-attachments/assets/b6a1c218-47b5-4ca0-8a5e-16179f9e1f6c" />

Sitten lisäsin vielä sinne Localhostin ja Portswigger.netin.

<img width="1240" height="568" alt="image" src="https://github.com/user-attachments/assets/973fb635-6b17-460f-b44b-d883d7708cbf" />

## PortSwigger Labs. Ratkaise tehtävät
Cross Site Scripting (XSS)
c) Reflected XSS into HTML context with nothing encoded
- Kirjoitin ensimmäisenä `Alert` labran nettisivun Search boxiin. Mitään ei tapahtunut, mutta Alert on h1 otsikon välissä joten Alert-funktiota ei voi kutsua siinä. Sen sijasta laitoin nettisivun hakukenttään `<script>alert(1)</script>` jonka jälkeen ensimmäinen labra oli suoritettu:

<img width="219" height="65" alt="image" src="https://github.com/user-attachments/assets/0251ec3a-ef55-4723-be89-d08a5dff2063" />

d) Stored XSS into HTML context with nothing encoded
- Tässä tehtävässä käytetään samaa `alert` scriptiä, mitä aikaisemmin. Avasin blogin, menin kommenttikenttään ja koitin sinne kirjoittaa saman scriptin, mitä viime tehtävässä.

<img width="663" height="650" alt="image" src="https://github.com/user-attachments/assets/af2657e2-3593-40b4-bca6-f38f88c2e7f8" />

- Ja näin sain syötettyä koodin ja seuraava labra ratkaistu:

<img width="245" height="121" alt="image" src="https://github.com/user-attachments/assets/33d75d3a-755f-4b80-a5c1-e7f9169c200c" />

e) Selitä esimerkin avulla, mitä hyökkääjä hyötyy XSS-hyökkäyksestä
- Xss-hyökkäyksessä ainakin näissä esimerkeissä ladattiin nettisivulle haitallista Javascript-koodia. Oikeasti alert-koodi ei ole haitallinen, Tehtävänannossa vain kerrottiin, että `alert` toimii hyökkäyskoodina. Koodilla voidaan mm. Kaapata jonkun käyttäjän istunto.

f) File path traversal
- Tässä tehtävässä käytetään File path traversalia. Avasin Zapissa yhden labran kuvista. Ja siellä oli kohta `Filename=48.jpg` Sitä kautta voi päästä hyökättävän kansioihin, kuten ylempänäkin käytiin läpi.

<img width="644" height="63" alt="image" src="https://github.com/user-attachments/assets/8205636c-026d-4fda-9597-b8873e629e06" />

Koitan siis vaihtaa tilalle ../../../etc/passwd.

<img width="657" height="105" alt="image" src="https://github.com/user-attachments/assets/852530b4-2155-4026-bc22-2ff721e2f90d" />

Tämän jälkeen menin takaisin labran sivulle ja tehtävä oli suoritettu:

<img width="1172" height="207" alt="image" src="https://github.com/user-attachments/assets/8ae026e6-a28e-4bd6-90d7-9dd124e3866b" />

g) File path traversal, traversal sequences blocked with absolute path bypass
- Tehtävänannossa kerrottiin, ettei tiedostoihin pääse yhtä helposti käsiksi, kuin edellisessä tehtävässä. Labran avattuani menin taas Zappiin ja siellä oli jälleen kuva tavalla `Filename=43.jpg`

<img width="648" height="60" alt="image" src="https://github.com/user-attachments/assets/62e2cfc4-4d91-4d2b-a00d-bb0ccd17c73a" />

- Tällä kertaa pitäisi löytää toinen tapa päästä tiedostoihin. Vastaus oli looginen: Muutetaan suoraan `Filename=etc/password` jonka jälkeen send

<img width="653" height="65" alt="image" src="https://github.com/user-attachments/assets/05d35500-41b2-49c7-8e68-65f78caaa021" />
 
Ja tämän jälkeen labra oli suoritettu

<img width="1178" height="215" alt="image" src="https://github.com/user-attachments/assets/9a010576-2ef9-4e98-af46-fd6e7112db19" />

h)  File path traversal, traversal sequences stripped non-recursively

- Tässä tehtävässä edelliset vastaukset eivät toimi. Tällä kertaa sivusto estää perinteiset polut, kuten //..etc/passwords, koitin aluksi laittaa jälleen filename=etc/password:
- Vastauksena "No such file".
- Jouduin sitten katsomaan hieman apua tehtävän sivuilta. Vastaus tähän oli `....//....//....//etc/passwd`. Sovellus poistaa tavalliset hakemistoketjut, mutta ei jos sen kirjoittaa tuplana, kuten tässä esimerkissä. Tämän avulla päästiin tarpeeksi ylös kansioissa.

<img width="200" height="77" alt="image" src="https://github.com/user-attachments/assets/bc5e6900-5bc2-4aad-b151-58292dc732d6" />

i) Insecure Direct Object Reference (IDOR)

- Tässä viimeisessä tehtävässä tavoitteena on löytää käyttäjän Carlos salasana ja kirjautua hänen tililleen. Ylempänä jo hieman selitinkin, että jos käyttäjänro näkyy url:ssä, sitä voi mahdollisesti hyödyntää.
- Tähänkin tehtävään jouduin käyttämään oljenkorsia. Ensiksi menin Labissa live-chattiin, lähetin viestin ja menin kohtaan view transcript. Zappiin oli ilmestynyt Trascripteihin txt.2.

<img width="431" height="51" alt="image" src="https://github.com/user-attachments/assets/f64e7767-8453-4fbe-b3d8-09437750e21e" />


- Kokeilen vaihtaa sen txt.1, jos se näyttäisi jonkun vanhan keskustelun.

- Tämän tehtyäni transcripteihin tosiaankin avautui txt.1

  <img width="437" height="85" alt="image" src="https://github.com/user-attachments/assets/e25b9123-253c-46ff-b821-3cf531a429a2" />

- Klikkasin sitten txt.1 ja painoin ctrl+W. Ja sieltä sitten löytyi jonkun vanha keskustelu, jossa Carlos sai uuden salasanan:

<img width="146" height="94" alt="image" src="https://github.com/user-attachments/assets/7e6eaaa8-1d58-4cbb-a052-b624599319b6" />

Kirjauduin sitten sivustolle. Käyttäjänimellä Carlos ja salasanan kopsasin keskustelusta. Pääsin kirjautumaan sisään ja labra suoritettu:

<img width="1227" height="587" alt="image" src="https://github.com/user-attachments/assets/29376268-0be5-490d-b527-092d9a84003c" />









 ## Lähteet
 - https://csrc.nist.gov/glossary/term/Deny_by_Default Deny by default määritelmä
 - https://portswigger.net/web-security/access-control/idor IDOR
 - https://portswigger.net/web-security/file-path-traversal Path traversal
 - https://portswigger.net/web-security/cross-site-scripting XSS
